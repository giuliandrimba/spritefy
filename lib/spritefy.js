var __t;__t=function(ns){var curr,index,part,parts,_i,_len;curr=null,parts=[].concat=ns.split(".");for(index=_i=0,_len=parts.length;_i<_len;index=++_i){part=parts[index];if(curr===null){curr=eval(part);continue}curr[part]==null?curr=curr[part]={}:curr=curr[part]}return curr};var app={};((function(){var a,b,c,d,e,f=function(a,b){return function(){return a.apply(b,arguments)}};__t("app.utils").PubSub=function(){function b(){}var a;return a=[],b.prototype.bind=function(b,c){return a.push({event:b,callback:c})},b.prototype.trigger=function(b,c){var d,e,f,g;g=[];for(e=0,f=a.length;e<f;e++)d=a[e],d.event===b?g.push(d.callback(c)):g.push(void 0);return g},b.prototype.unbind=function(b,c){var d,e,f,g,h;h=[];for(e=f=0,g=a.length;f<g;e=++f)d=a[e],d.event===b&&d.callback()===c()?h.push(a.slice(e,0)):h.push(void 0);return h},b}(),e=require("util"),c=require("path"),b=require("fs"),__t("app.build").PluginBuilder=function(){function d(a){this.at=a,this.at&&(this.new_path=c.resolve(this.at,"scripts"))}var a;return d.prototype.plugin_file=c.join(c.dirname(b.realpathSync(__filename)),"../spritefy-animation/jquery.spritefy.js"),d.prototype.plugin_file_min=c.join(c.dirname(b.realpathSync(__filename)),"../spritefy-animation/jquery.spritefy.min.js"),d.prototype.new_path=c.resolve("scripts/"),d.prototype.build=function(){return c.existsSync(this.new_path)===!1&&b.mkdirSync(this.new_path),a(this.plugin_file,""+this.new_path+"/jquery.spritefy.js"),a(this.plugin_file_min,""+this.new_path+"/jquery.spritefy.min.js")},a=function(a,c){var d,e,f,g,h,i;d=65536,e=new Buffer(d),g=b.openSync(a,"r"),h=b.openSync(c,"w"),f=1,i=0;while(f>0)f=b.readSync(g,e,0,d,i),b.writeSync(h,e,0,f),i+=f;return b.closeSync(g),b.closeSync(h)},d}(),a=require("easyimage"),c=require("path"),__t("app.build").SpriteBuilder=function(){function d(a,b,c){var d,e,g,h;this.images=a,this.name=b,this.at=c,this.build=f(this.build,this),h=this.images;for(e=0,g=h.length;e<g;e++)d=h[e],this.files_path.push(d.file);this.list_files=this.files_path.join(" ")}return d.prototype.images=[],d.prototype.name="",d.prototype.file_text="",d.prototype.sprite_path="",d.prototype.files_path=[],d.prototype.files_list=[],d.prototype.build=function(d,e){var f,g=this;return this.sprite_path=c.resolve("sprites/"),this.at&&(this.sprite_path=c.resolve(this.at,"sprites")),c.existsSync(""+this.sprite_path+"/"+this.name+".png")&&b.unlink(""+this.sprite_path+"/"+this.name+".png"),f="convert "+this.list_files+" -transparent white -background None +append "+this.sprite_path+"/"+this.name+".png",a.exec(f,function(a,b,c){if(a)throw a;if(e)return e()})},d}(),b=require("fs"),c=require("path"),__t("app.build").StyleBuilder=function(){function a(a,b,c){this.images=a,this.name=b,this.at=c,this.step=f(this.step,this),this.generate_animation=f(this.generate_animation,this),this.build=f(this.build,this)}return a.prototype.images=[],a.prototype.name="",a.prototype.min=!1,a.prototype.file_text="",a.prototype.file_text_min="",a.prototype.css_path="css",a.prototype.steps=0,a.prototype.step_count=0,a.prototype.animation_time=1,a.prototype.build=function(a,d){var e;e=c.resolve("sprites"),this.at&&(e=c.resolve(this.at,"sprites")),c.existsSync(e)===!1&&b.mkdirSync(e),this.generate_animation("webkit"),this.generate_animation("moz"),this.animation_time=this.images.length*1/30,this.file_text+="\n\n."+this.name+"\n{\n\tbackground-image:url('"+this.name+".png');\n\tdisplay: block;\n\twidth:"+this.images[0].width+"px;\n\theight:"+this.images[0].height+"px;\n}\n\n."+this.name+"-animation\n{\n\tbackground-image:url('"+this.name+".png');\n\tdisplay: block;\n\twidth:"+this.images[0].width+"px;\n\theight:"+this.images[0].height+"px;\n\t-moz-animation-duration: "+this.animation_time+"s;\n\t-moz-animation-name: "+this.name+";\n\t-moz-animation-timing-function: step-end;\n\t-moz-animation-iteration-count:infinite;\n\t-moz-animation-fill-mode: backwards;\n\t-webkit-animation-duration: "+this.animation_time+"s;\n\t-webkit-animation-name: "+this.name+";\n\t-webkit-animation-timing-function: step-end;\n\t-webkit-animation-iteration-count:infinite;\n\t-webkit-animation-fill-mode: backwards;\n}\n",this.file_text_min+="."+this.name+" {background-image:url('"+this.name+".png');display: block;width:"+this.images[0].width+"px;height:"+this.images[0].height+"px;}."+this.name+"-animation{background-image:url('"+this.name+".png');display: block;width:"+this.images[0].width+"px;height:"+this.images[0].height+"px;-moz-animation-duration: "+this.animation_time+"s;-moz-animation-name: "+this.name+";-moz-animation-timing-function: step-end;-moz-animation-iteration-count:infinite;-moz-animation-fill-mode: backwards;-webkit-animation-duration: "+this.animation_time+"s;-webkit-animation-name: "+this.name+";-webkit-animation-timing-function: step-end;-webkit-animation-iteration-count:infinite;-webkit-animation-fill-mode: backwards;}",b.writeFileSync(""+e+"/"+this.name+".css",this.file_text),b.writeFileSync(""+e+"/"+this.name+"-compressed.css",this.file_text_min);if(d)return d()},a.prototype.generate_animation=function(a){var b,c,d,e,f,g,h,i;b=0,this.steps=100/this.images.length,c=this.images[0],f=this.images[this.images.length-1],this.file_text+="@-"+a+"-keyframes "+this.name+"\n",this.file_text+="{",this.file_text_min+="@-"+a+"-keyframes "+this.name+"{",i=this.images;for(d=g=0,h=i.length;g<h;d=++g)e=i[d],this.file_text+=this.step(this.step_count,e,b),this.file_text_min+=this.step(this.step_count,e,b,!0),b-=parseInt(e.width),this.step_count+=this.steps;return this.file_text+=this.step(100,f,b+f.width),this.file_text_min+=this.step(100,f,b+f.width,!0),this.file_text+="\n}\n",this.file_text_min+="}",this.step_count=0},a.prototype.step=function(a,b,c,d){var e;return d?e=""+a+"%{background-position: "+c+"px;width: "+b.width+"px;height: "+b.height+"px;}":e=("\n\n"+a+"%\n{\n\tbackground-position: "+c+"px;\n}").replace(/(^)(.*)$/gm,"\t$1$2"),e},a}(),b=require("fs"),a=require("easyimage"),__t("app.utils").ImagesFilter=function(){function e(a){this.folder_path=a,this.trigger=f(this.trigger,this),this.bind=f(this.bind,this),this.get_images()}var c,d;return d="",e.prototype.images=[],e.prototype.pubsub=new app.utils.PubSub,c=0,e.prototype.error_messages={not_found:"ERROR: Images not found in the folder"},e.prototype.get_images=function(){var a,c=this;return a=new RegExp(".*(jpg|png|gif)$"),b.readdir(this.folder_path,function(b,d){var e,f,g,h,i;if(b)throw b;for(f=h=0,i=d.length;h<i;f=++h)e=d[f],g=a.test(e),g&&c.images.push({file:""+c.folder_path+"/"+e});return c.images.length>0?c.setup_images(function(){return c.pubsub.trigger("complete",c.images)}):console.log(c.error_messages.not_found)})},e.prototype.setup_images=function(b){var d=this;return a.info(this.images[c].file,function(a,e){var f;if(a)throw a;(f=d.images[c]).width=parseInt(e.width),f.height=parseInt(e.height),f.size=e.size,f.type=e.type,f.file=""+d.folder_path+"/"+e.name;if(++c<d.images.length)return d.setup_images(b);if(c>=d.images.length)return b()})},e.prototype.bind=function(a,b){return this.pubsub.bind(a,b)},e.prototype.trigger=function(a){return this.pubsub.trigger(a)},e}(),b=require("fs"),d=require("commander"),c=require("path"),__t("app").Main=function(){function a(){this.build_finished=f(this.build_finished,this),this.generate_sprite=f(this.generate_sprite,this),this.generate_style=f(this.generate_style,this)}return a.prototype.folder="",a.prototype.name="sprite",a.prototype.builds_concluded=0,a.prototype.min=!1,a.prototype.messages={success:"Spritesheet and Stylesheet generation completed!"},a.prototype.generate=function(a,d,e,f){return this.folder=a,this.name=d,this.at=e,this.callback=f,this.folder=c.resolve(this.folder),this.at=c.resolve(this.at),c.existsSync(this.at)||b.mkdirSync(this.at),this.images_filter=new app.utils.ImagesFilter(this.folder),this.images_filter.bind("complete",this.generate_style),this.images_filter.bind("complete",this.generate_sprite),this.generate_jquery_plugin()},a.prototype.generate_style=function(a){return this.style=new app.build.StyleBuilder(a,this.name,this.at),this.style.build(this.folder,this.build_finished)},a.prototype.generate_sprite=function(a){return this.sprite=new app.build.SpriteBuilder(a,this.name,this.at),this.sprite.build(this.folder,this.build_finished)},a.prototype.generate_jquery_plugin=function(){return this.plugin=new app.build.PluginBuilder(this.at),this.plugin.build()},a.prototype.build_finished=function(){++this.builds_concluded;if(this.builds_concluded>=2)return console.log(this.messages.success),typeof this.callback=="function"?this.callback():void 0},a}(),module.exports=app.Main})).call(this)